<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê°€êµ¬ ì´ˆì„± í€´ì¦ˆ</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700&display=swap');

        /* --- ê¸°ë³¸ ìŠ¤íƒ€ì¼ --- */
        * {
            box-sizing: border-box; /* ë ˆì´ì•„ì›ƒ ê³„ì‚°ì„ ì‰½ê²Œ í•¨ */
        }
        
        html, body {
            height: 100%; /* ê°€ìƒ í‚¤ë³´ë“œê°€ ìˆì–´ë„ ì „ì²´ í™”ë©´ì„ ìœ ì§€ */
            font-family: 'Noto Sans KR', sans-serif;
            background-color: #f5f5f5; /* ì—°í•œ íšŒìƒ‰ ë°°ê²½ */
            color: #333;
            margin: 0;
            /* ëª¨ë°”ì¼ì—ì„œ ì˜¤ë²„ìŠ¤í¬ë¡¤(ë°”ìš´ìŠ¤) ë°©ì§€ */
            overflow: hidden; 
        }

        body {
            display: flex;
            flex-direction: column; /* ì»¨í…ì¸ ë¥¼ ì„¸ë¡œë¡œ ì •ë ¬ */
            justify-content: center; /* (ìˆ˜ì •) ì¤‘ì•™ ì •ë ¬ */
            align-items: center;
        }

        /* --- ê²Œì„ ì»¨í…Œì´ë„ˆ --- */
        #game-container {
            width: 100%;
            max-width: 500px;
            background-color: #ffffff;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            padding: 20px 25px;
            border: 2px solid #ddd;
            
            /* (ìˆ˜ì •) Flexbox ìì‹ ìš”ì†Œë¡œ ë³€ê²½ */
            display: flex;
            flex-direction: column;
        }

        /* --- ìƒíƒœ í‘œì‹œì¤„ --- */
        #status-bar {
            display: flex;
            justify-content: space-between;
            font-size: 1.1rem;
            font-weight: 700;
            color: #555;
            margin-bottom: 15px; /* ê°„ê²© ì¡°ì • */
        }

        /* --- ì´ˆì„± --- */
        #choseong-display {
            font-size: 3.5rem; /* ì•½ê°„ ì¤„ì„ */
            font-weight: 700;
            color: #6a1b9a; /* ë³´ë¼ìƒ‰ ê³„ì—´ */
            letter-spacing: 10px;
            margin-bottom: 15px;
            padding: 20px 0;
            background-color: #f8f9fa;
            border-radius: 10px;
            text-align: center; /* ì¶”ê°€ */
        }

        /* --- íƒ€ì´ë¨¸ --- */
        #timer-bar-container {
            width: 100%;
            height: 10px;
            background-color: #e9ecef;
            border-radius: 5px;
            overflow: hidden;
        }

        #timer-bar {
            width: 100%;
            height: 100%;
            background-color: #4caf50; /* ì´ˆë¡ìƒ‰ */
            transition: width 1s linear;
        }

        /* --- íŒíŠ¸ ì˜ì—­ (ìˆ˜ì •) --- */
        #hint-area {
            min-height: 120px; /* ê³ ì • ë†’ì´ ìœ ì§€ */
            margin-top: 15px;
            display: flex;
            flex-direction: column; /* (ìˆ˜ì •) íŒíŠ¸/í”¼ë“œë°±ì„ ì„¸ë¡œë¡œ ìŒ“ìŒ */
            justify-content: center;
            align-items: center;
            border: 2px dashed #ddd;
            border-radius: 10px;
            padding: 10px;
            text-align: center;
        }

        .hint-box { font-size: 1rem; color: #555; }
        #image-hint { font-size: 4rem; } /* ì•½ê°„ ì¤„ì„ */
        #image-hint.hidden { display: none; }

        /* --- í”¼ë“œë°± ë©”ì‹œì§€ (ìˆ˜ì •) --- */
        .feedback {
            font-size: 1.1rem; /* íŒíŠ¸ ë°•ìŠ¤ì— ë§ê²Œ í°íŠ¸ ì¡°ì • */
            font-weight: 700;
            padding: 10px; /* íŒíŠ¸ ë°•ìŠ¤ì— ë§ê²Œ íŒ¨ë”© ì¡°ì • */
            display: none; /* JSë¡œ ì»¨íŠ¸ë¡¤ */
            border-radius: 10px;
            /* margin-top: 10px; <-- ì œê±°ë¨ */
            text-align: center;
            width: 100%; /* íŒíŠ¸ ì˜ì—­ì„ ê½‰ ì±„ì›€ */
        }
        .feedback.correct { color: #28a745; background-color: #e6f7ec; }
        .feedback.wrong { color: #dc3545; background-color: #fdeeee; }
        .feedback.info { color: #555; background-color: #f0f0f0; }
        
        /* --- ì…ë ¥ ì˜ì—­ --- */
        #input-area {
            margin-top: 15px; /* ê°„ê²© ì¡°ì • */
            display: flex;
            gap: 10px;
        }

        #answer-input {
            flex-grow: 1;
            padding: 15px;
            font-size: 1.2rem;
            border: 2px solid #ced4da;
            border-radius: 10px;
            transition: border-color 0.3s;
            text-align: center; /* ì…ë ¥ê°’ ì¤‘ì•™ ì •ë ¬ */
            font-weight: 700;
            color: #333;
            font-family: 'Noto Sans KR', sans-serif; /* í•œê¸€ í°íŠ¸ ì ìš© */
        }

        #answer-input:focus {
            border-color: #6a1b9a;
            outline: none;
        }

        /* ëª¨ë°”ì¼ì—ì„œ ë„¤ì´í‹°ë¸Œ í‚¤ë³´ë“œ ìˆ¨ê¸¸ ì‹œ ì»¤ì„œ(ê¹œë°•ì„)ë„ ìˆ¨ê¹€ */
        #answer-input[readonly] {
            caret-color: transparent;
        }

        #submit-btn {
            padding: 15px 25px;
            font-size: 1.2rem;
            font-weight: 700;
            background-color: #6a1b9a;
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        #submit-btn:hover { background-color: #4a148c; }

        /* --- ê°€ìƒ í‚¤ë³´ë“œ --- */
        #virtual-keyboard {
            width: 100%;
            max-width: 500px;
            margin-top: 15px;
            padding: 10px;
            background-color: #e9ecef;
            border-radius: 10px;
        }
        
        .kbd-row {
            display: flex;
            justify-content: center;
            gap: 6px; /* í‚¤ ì‚¬ì´ ê°„ê²© */
            margin-bottom: 6px;
        }
        .kbd-row:last-child {
            margin-bottom: 0;
        }

        .kbd-key {
            font-family: 'Noto Sans KR', sans-serif;
            font-size: 1.1rem;
            font-weight: 700;
            background-color: #ffffff;
            color: #333;
            border: none;
            border-radius: 8px;
            padding: 12px 0; /* ì„¸ë¡œ í¬ê¸° */
            flex-grow: 1; /* í‚¤ê°€ ê· ë“±í•˜ê²Œ ê½‰ ì°¨ë„ë¡ */
            flex-basis: 0; /* flex-growë¥¼ ìœ„í•œ ê¸°ë³¸ê°’ */
            min-width: 30px; /* ìµœì†Œ ë„ˆë¹„ */
            
            cursor: pointer;
            user-select: none; /* ëª¨ë°”ì¼ì—ì„œ í´ë¦­ ì‹œ í•˜ì´ë¼ì´íŠ¸ ë°©ì§€ */
            -webkit-user-select: none; /* Safari */
            
            box-shadow: 0 2px 2px rgba(0, 0, 0, 0.1);
            transition: background-color 0.1s, transform 0.1s;
        }

        .kbd-key:active {
            background-color: #ddd;
            transform: translateY(1px); /* í´ë¦­ íš¨ê³¼ */
        }
        
        /* íŠ¹ìˆ˜ í‚¤ (ì§€ìš°ê¸°, í™•ì¸) */
        .kbd-key.special {
            flex-grow: 1.5; /* ë” ë„“ê²Œ */
            background-color: #adb5bd;
            color: white;
            font-size: 0.9rem; /* [ìˆ˜ì •] ê¸€ì í¬ê¸° ì¡°ì • */
        }
        .kbd-key.special:active {
            background-color: #868e96;
        }
        /* [ì¶”ê°€] Shift í™œì„±í™” ì‹œ ìŠ¤íƒ€ì¼ */
        .kbd-key.shift-active {
            background-color: #a5b4fc; /* Shift ëˆŒë¦¼ íš¨ê³¼ */
            color: #1e3a8a;
        }

        /* --- ê²Œì„ ì¢…ë£Œ ì˜¤ë²„ë ˆì´ --- */
        #game-over-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            justify-content: center;
            align-items: center;
            z-index: 100;
        }

        #game-over-box {
            background-color: white;
            padding: 40px 50px;
            border-radius: 20px;
            text-align: center;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
            animation: zoomIn 0.5s ease;
        }
        #game-over-box h2 { font-size: 2.5rem; color: #6a1b9a; margin-top: 0; }
        #game-over-box p { font-size: 1.5rem; margin-bottom: 30px; }
        #restart-btn {
            padding: 15px 30px;
            font-size: 1.3rem;
            font-weight: 700;
            background-color: #28a745;
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        #restart-btn:hover { background-color: #218838; }
        
        @keyframes zoomIn {
            from { transform: scale(0.5); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }

        /* ëª¨ë°”ì¼ í™”ë©´ ëŒ€ì‘ (ê°€ë¡œ ëª¨ë“œ ë“±) */
        @media (max-height: 700px) and (orientation: landscape) {
            /* ê°€ë¡œ ëª¨ë“œì—ì„œëŠ” í‚¤ë³´ë“œê°€ ë„ˆë¬´ ì»¤ì§€ì§€ ì•Šë„ë¡ ì¡°ì • */
            #virtual-keyboard {
                max-width: 450px;
                margin-top: 10px;
                padding: 5px;
            }
            .kbd-key {
                padding: 8px 0;
                font-size: 1rem;
            }
            .kbd-row { gap: 4px; margin-bottom: 4px; }
            #game-container { padding: 15px 20px; }
        }
        @media (max-width: 380px) {
             /* ì•„ì£¼ ì‘ì€ ì„¸ë¡œ í™”ë©´ */
            #choseong-display { font-size: 2.8rem; }
            #image-hint { font-size: 3rem; }
            .kbd-key { 
                font-size: 0.9rem; /* [ìˆ˜ì •] */
                padding: 10px 0; 
            }
        }

    </style>
</head>
<body>

    <!-- ê²Œì„ ì»¨í…ì¸  -->
    <div id="game-container">
        <div id="status-bar">
            <span id="question-counter">ë¬¸ì œ 1 / 10</span>
            <span id="total-score">ì´ ì ìˆ˜: 0 ì </span>
        </div>
        <div id="question-area">
            <div id="choseong-display">ã…Šã„·</div>
            <div id="timer-bar-container">
                <div id="timer-bar"></div>
            </div>
        </div>

        <!-- (ìˆ˜ì •) íŒíŠ¸ ì˜ì—­: í”¼ë“œë°± ë©”ì‹œì§€ë¥¼ ì´ ì•ˆìœ¼ë¡œ ì´ë™ -->
        <div id="hint-area">
            <!-- íŒíŠ¸ ì»¨í…ì¸  -->
            <div id="image-hint" class="hint-box hidden"></div>
            <div id="initial-hint-text" class="hint-box">10ì´ˆ í›„ì— ì´ë¯¸ì§€ íŒíŠ¸ê°€ ë‚˜ì˜µë‹ˆë‹¤. (ì´ 20ì´ˆ)</div>
            
            <!-- í”¼ë“œë°± ë©”ì‹œì§€ (ì´ë™ë¨) -->
            <div id="feedback-correct" class="feedback correct">ì •ë‹µì…ë‹ˆë‹¤! (+0ì )</div>
            <div id="feedback-wrong" class="feedback wrong">í‹€ë ¸ìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•˜ì„¸ìš”.</div>
            <div id="feedback-timeout" class="feedback info">ì‹œê°„ ì´ˆê³¼! ì •ë‹µ: </div>
        </div>

        <!-- ì •ë‹µ ì…ë ¥ ì˜ì—­ -->
        <div id="input-area">
            <input type="text" id="answer-input" placeholder="ì •ë‹µì„ ì…ë ¥í•˜ì„¸ìš”...">
            <button id="submit-btn">í™•ì¸</button>
        </div>
    </div>
    
    <!-- ê°€ìƒ í‚¤ë³´ë“œ HTML (2ë²Œì‹ ì¿¼í‹°) -->
    <div id="virtual-keyboard">
        <div class="kbd-row" id="kbd-row-1">
            <button class="kbd-key" data-key="ã…‚" data-shift="ã…ƒ">ã…‚</button>
            <button class="kbd-key" data-key="ã…ˆ" data-shift="ã…‰">ã…ˆ</button>
            <button class="kbd-key" data-key="ã„·" data-shift="ã„¸">ã„·</button>
            <button class="kbd-key" data-key="ã„±" data-shift="ã„²">ã„±</button>
            <button class="kbd-key" data-key="ã……" data-shift="ã…†">ã……</button>
            <button class="kbd-key" data-key="ã…›">ã…›</button>
            <button class="kbd-key" data-key="ã…•">ã…•</button>
            <button class="kbd-key" data-key="ã…‘">ã…‘</button>
            <button class="kbd-key" data-key="ã…" data-shift="ã…’">ã…</button>
            <button class="kbd-key" data-key="ã…”" data-shift="ã…–">ã…”</button>
        </div>
        <div class="kbd-row" id="kbd-row-2">
            <button class="kbd-key" data-key="ã…">ã…</button>
            <button class="kbd-key" data-key="ã„´">ã„´</button>
            <button class="kbd-key" data-key="ã…‡">ã…‡</button>
            <button class="kbd-key" data-key="ã„¹">ã„¹</button>
            <button class="kbd-key" data-key="ã…">ã…</button>
            <button class="kbd-key" data-key="ã…—">ã…—</button>
            <button class="kbd-key" data-key="ã…“">ã…“</button>
            <button class="kbd-key" data-key="ã…">ã…</button>
            <button class="kbd-key" data-key="ã…£">ã…£</button>
        </div>
        <div class="kbd-row" id="kbd-row-3">
            <button class="kbd-key special" data-key="shift">Shift</button>
            <button class="kbd-key" data-key="ã…‹">ã…‹</button>
            <button class="kbd-key" data-key="ã…Œ">ã…Œ</button>
            <button class="kbd-key" data-key="ã…Š">ã…Š</button>
            <button class="kbd-key" data-key="ã…">ã…</button>
            <button class="kbd-key" data-key="ã… ">ã… </button>
            <button class="kbd-key" data-key="ã…œ">ã…œ</button>
            <button class="kbd-key" data-key="ã…¡">ã…¡</button>
        </div>
        <div class="kbd-row" id="kbd-row-4">
            <button class="kbd-key special" data-key="del">ì§€ìš°ê¸°</button>
            <button class="kbd-key special" data-key="enter">í™•ì¸</button>
        </div>
    </div>
    
    <!-- ê²Œì„ ì¢…ë£Œ í™”ë©´ (ë³€ë™ ì—†ìŒ) -->
    <div id="game-over-overlay">
        <div id="game-over-box">
            <h2>ê²Œì„ ì¢…ë£Œ!</h2>
            <p id="final-score">ìµœì¢… ì ìˆ˜: 0 ì </p>
            <button id="restart-btn">ë‹¤ì‹œ ì‹œì‘í•˜ê¸°</button>
        </div>
    </div>

    <script>
        // --- 1. ë°ì´í„° ---
        // *** (ìˆ˜ì •) 'ì˜·ì¥' -> 'ì¥ë¡±'ìœ¼ë¡œ ë³€ê²½ (ã…‡ã…ˆ ì¤‘ë³µ ë²„ê·¸ ìˆ˜ì •)
        const questionBank = [
            { choseong: 'ã…Šã„·', answer: 'ì¹¨ëŒ€', imageHint: 'ğŸ›ï¸' },
            { choseong: 'ã…‡ã…ˆ', answer: 'ì˜ì', imageHint: 'ğŸª‘' },
            { choseong: 'ã…Šã……', answer: 'ì±…ìƒ', imageHint: 'ğŸ§‘â€ğŸ’»ğŸ“’âœï¸' }, // ì±…ìƒ
            { choseong: 'ã……ã…Œ', answer: 'ì‹íƒ', imageHint: 'ğŸ½ï¸' }, // ì‹íƒ
            { choseong: 'ã……ã„¹', answer: 'ì„œë', imageHint: 'ğŸ—„ï¸' }, // ì„œë
            { choseong: 'ã……ã…', answer: 'ì†ŒíŒŒ', imageHint: 'ğŸ›‹ï¸' }, // ì†ŒíŒŒ
            { choseong: 'ã…ˆã„¹', answer: 'ì¥ë¡±', imageHint: 'ğŸ‘šğŸ‘• ' }, // 'ì˜·ì¥(ã…‡ã…ˆ)' -> 'ì¥ë¡±(ã…ˆã„¹)'
            { choseong: 'ã…Šã„²ã…‡', answer: 'ì±…ê½‚ì´', imageHint: 'ğŸ“šğŸ“šğŸ“š' }, // ì±…ê½‚ì´
            { choseong: 'ã„±ã…‡', answer: 'ê±°ìš¸', imageHint: 'ğŸª' }, // ê±°ìš¸
            { choseong: 'ã…Œã…ˆ', answer: 'íƒì', imageHint: 'â˜•ï¸ğŸµ' }  // íƒì
        ];

        let shuffledQuestions = [];
        let currentQuestionIndex = 0;
        let totalScore = 0;
        let currentPoints = 2;
        let questionTimer;
        let secondsElapsed;

        // --- 2. HTML ìš”ì†Œ ê°€ì ¸ì˜¤ê¸° ---
        const questionCounterEl = document.getElementById('question-counter');
        const totalScoreEl = document.getElementById('total-score');
        const choseongDisplayEl = document.getElementById('choseong-display');
        const timerBarEl = document.getElementById('timer-bar');
        const initialHintTextEl = document.getElementById('initial-hint-text');
        const imageHintEl = document.getElementById('image-hint');
        const answerInputEl = document.getElementById('answer-input');
        const submitBtnEl = document.getElementById('submit-btn');
        
        // (ìˆ˜ì •) í”¼ë“œë°± ìš”ì†Œ (HTML DOM êµ¬ì¡°ëŠ” ë™ì¼í•˜ê²Œ ìœ ì§€, JSë¡œ ì œì–´)
        const feedbackCorrectEl = document.getElementById('feedback-correct');
        const feedbackWrongEl = document.getElementById('feedback-wrong');
        const feedbackTimeoutEl = document.getElementById('feedback-timeout');
        
        const gameOverOverlayEl = document.getElementById('game-over-overlay');
        const finalScoreEl = document.getElementById('final-score');
        const restartBtnEl = document.getElementById('restart-btn');
        
        const virtualKeyboardEl = document.getElementById('virtual-keyboard');

        // --- 3. í•µì‹¬ ê¸°ëŠ¥ í•¨ìˆ˜ ---

        const isTouchDevice = ('ontouchstart' in window) || (navigator.maxTouchPoints > 0);

        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        function startGame() {
            totalScore = 0;
            currentQuestionIndex = 0;
            shuffledQuestions = shuffleArray([...questionBank]); 
            totalScoreEl.textContent = `ì´ ì ìˆ˜: 0 ì `;
            gameOverOverlayEl.style.display = 'none';
            displayQuestion();
        }

        // (ìˆ˜ì •) íŒíŠ¸/í”¼ë“œë°± ì˜ì—­ ê´€ë¦¬ í•¨ìˆ˜
        function showInHintArea(elementToShow) {
            // ëª¨ë“  íŒíŠ¸/í”¼ë“œë°± ìš”ì†Œ ìˆ¨ê¸°ê¸°
            initialHintTextEl.style.display = 'none';
            imageHintEl.classList.add('hidden');
            feedbackCorrectEl.style.display = 'none';
            feedbackWrongEl.style.display = 'none';
            feedbackTimeoutEl.style.display = 'none';

            // ìš”ì²­ëœ ìš”ì†Œë§Œ í‘œì‹œ
            if (elementToShow === 'initial') {
                initialHintTextEl.style.display = 'block';
            } else if (elementToShow === 'image') {
                imageHintEl.classList.remove('hidden');
            } else if (elementToShow === 'correct') {
                feedbackCorrectEl.style.display = 'block';
            } else if (elementToShow === 'wrong') {
                feedbackWrongEl.style.display = 'block';
            } else if (elementToShow === 'timeout') {
                feedbackTimeoutEl.style.display = 'block';
            }
        }
        
        // (ìˆ˜ì •) resetHintsê°€ íŒíŠ¸ ì˜ì—­ ê´€ë¦¬ í•¨ìˆ˜ ì‚¬ìš©
        function resetHints() {
            showInHintArea('initial'); // íŒíŠ¸/í”¼ë“œë°± ì˜ì—­ ì´ˆê¸°í™”
        }

        // (ìˆ˜ì •) displayQuestionì´ íŒíŠ¸ ì˜ì—­ ê´€ë¦¬ í•¨ìˆ˜ ì‚¬ìš©
        function displayQuestion() {
            resetHints(); // ì´ê²ƒì´ ëª¨ë“  í”¼ë“œë°±ì„ ìˆ¨ê¸°ê³  íŒíŠ¸ ì´ˆê¸°í™”

            answerInputEl.value = '';
            answerInputEl.disabled = false;
            submitBtnEl.disabled = false;
            
            if (isTouchDevice) {
                answerInputEl.readOnly = true;
                answerInputEl.style.caretColor = 'transparent';
            } else {
                answerInputEl.readOnly = false;
                answerInputEl.style.caretColor = 'auto';
                answerInputEl.focus();
            }

            if (currentQuestionIndex >= 10) {
                showGameResult();
                return;
            }

            currentPoints = 2;
            secondsElapsed = 0;
            timerBarEl.style.transition = 'none'; 
            timerBarEl.style.width = '100%';
            timerBarEl.style.backgroundColor = '#4caf50'; 
            
            const question = shuffledQuestions[currentQuestionIndex];
            choseongDisplayEl.textContent = question.choseong;
            questionCounterEl.textContent = `ë¬¸ì œ ${currentQuestionIndex + 1} / 10`;

            clearInterval(questionTimer); 
            questionTimer = setInterval(updateTimer, 1000);
            
            setTimeout(() => {
                timerBarEl.style.transition = 'width 1s linear';
            }, 100);
        }

        function updateTimer() {
            secondsElapsed++;
            const totalTime = 20;
            let timeRemainingPercent = 100 - (secondsElapsed / totalTime) * 100;
            timerBarEl.style.width = `${timeRemainingPercent}%`;

            if (secondsElapsed === 10) {
                currentPoints = 1;
                showImageHint();
                timerBarEl.style.backgroundColor = '#ffc107';
            }
            else if (secondsElapsed === 20) {
                currentPoints = 0;
                clearInterval(questionTimer);
                handleTimeout();
            }
        }

        // (ìˆ˜ì •) showImageHintê°€ íŒíŠ¸ ì˜ì—­ ê´€ë¦¬ í•¨ìˆ˜ ì‚¬ìš©
        function showImageHint() {
            const question = shuffledQuestions[currentQuestionIndex];
            imageHintEl.textContent = question.imageHint;
            showInHintArea('image'); // ì´ë¯¸ì§€ íŒíŠ¸ í‘œì‹œ
        }

        // (ìˆ˜ì •) handleTimeoutì´ íŒíŠ¸ ì˜ì—­ ê´€ë¦¬ í•¨ìˆ˜ ì‚¬ìš©
        function handleTimeout() {
            answerInputEl.disabled = true;
            submitBtnEl.disabled = true;
            
            const correctAnswerWord = shuffledQuestions[currentQuestionIndex].answer;
            feedbackTimeoutEl.textContent = `ì‹œê°„ ì´ˆê³¼! ì •ë‹µ: ${correctAnswerWord}`;
            showInHintArea('timeout'); // ì‹œê°„ ì´ˆê³¼ í”¼ë“œë°± í‘œì‹œ

            setTimeout(startGame, 2000); // startGameì´ íŒíŠ¸ ì˜ì—­ ë¦¬ì…‹
        }

        // (ìˆ˜ì •) checkAnswerê°€ íŒíŠ¸ ì˜ì—­ ê´€ë¦¬ í•¨ìˆ˜ ì‚¬ìš©
        function checkAnswer() {
            const userInput = answerInputEl.value.trim();
            const correctAnswer = shuffledQuestions[currentQuestionIndex].answer;

            if (!userInput) return; 

            // 1. ì •ë‹µì¸ ê²½ìš°
            if (userInput === correctAnswer) {
                clearInterval(questionTimer);
                answerInputEl.disabled = true;
                submitBtnEl.disabled = true;

                totalScore += currentPoints;
                totalScoreEl.textContent = `ì´ ì ìˆ˜: ${totalScore} ì `;
                
                feedbackCorrectEl.textContent = `ì •ë‹µ! +${currentPoints}ì `;
                showInHintArea('correct'); // ì •ë‹µ í”¼ë“œë°±

                currentQuestionIndex++;
                
                setTimeout(displayQuestion, 1500); // displayQuestionì´ íŒíŠ¸ ì˜ì—­ ë¦¬ì…‹
            }
            // 2. ì˜¤ë‹µì¸ ê²½ìš°
            else {
                feedbackWrongEl.textContent = 'í‹€ë ¸ìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•˜ì„¸ìš”.';
                showInHintArea('wrong'); // ì˜¤ë‹µ í”¼ë“œë°±
                
                // --- [ì‚¬ìš©ì ìš”ì²­] ì˜¤ë‹µ ì‹œ ì…ë ¥ê°’ ì‚­ì œ ---
                answerInputEl.value = ''; 
                
                // (ì„ íƒ) PCì¸ ê²½ìš° ì‚­ì œ í›„ ë‹¤ì‹œ í¬ì»¤ìŠ¤
                if (!isTouchDevice) {
                    answerInputEl.focus();
                }
                // --- [ìˆ˜ì • ì™„ë£Œ] ---

                setTimeout(() => {
                    // (ìˆ˜ì •) ì‹œê°„ì´ 10ì´ˆ ì§€ë‚¬ëŠ”ì§€ì— ë”°ë¼ íŒíŠ¸ ë³µì›
                    if (secondsElapsed >= 10) {
                        showInHintArea('image');
                    } else {
                        showInHintArea('initial');
                    }
                }, 1000);
            }
        }

        function showGameResult() {
            finalScoreEl.textContent = `ìµœì¢… ì ìˆ˜: ${totalScore} ì `;
            gameOverOverlayEl.style.display = 'flex';

            const scoreMessage = {
                type: 'game_score',
                score: totalScore 
            };
            if (window.parent) {
                window.parent.postMessage(scoreMessage, '*');
            }
        }

        // --- 4. ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ---
        
        submitBtnEl.addEventListener('click', checkAnswer);
        answerInputEl.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                checkAnswer();
            }
        });
        restartBtnEl.addEventListener('click', startGame);
        
        virtualKeyboardEl.addEventListener('click', function(e) {
            const key = e.target.closest('.kbd-key');
            if (!key) return; 
            if (answerInputEl.disabled) return;

            // --- [ìˆ˜ì •] keyVal ë¡œì§ ë³€ê²½ ---
            let keyVal;
            if (key.dataset.key === 'shift') {
                keyVal = 'shift';
            } else if (key.dataset.key === 'del') {
                keyVal = 'del';
            } else if (key.dataset.key === 'enter') {
                keyVal = 'enter';
            } else {
                // Shift ìƒíƒœë¥¼ í™•ì¸í•˜ì—¬ data-shift ë˜ëŠ” data-key ê°’ì„ ê°€ì ¸ì˜´
                keyVal = isShifted ? (key.dataset.shift || key.dataset.key) : key.dataset.key;
            }
            // --- [ìˆ˜ì • ì™„ë£Œ] ---

            if (keyVal === 'enter') {
                checkAnswer();
            } else if (keyVal === 'del') {
                handleBackspace();
            } else if (keyVal === 'shift') {
                toggleShift(); // Shift í‚¤ ìì²´ë¥¼ ëˆŒë €ì„ ë•Œë§Œ í† ê¸€
            } else {
                typeHangul(keyVal); // 'ã…‚' ë˜ëŠ” 'ã…ƒ' ê°™ì€ ì‹¤ì œ ê¸€ì ê°’ ì „ë‹¬
            }
            
            if (!isTouchDevice) {
                answerInputEl.focus();
            }
        });
        
        // --- (ìˆ˜ì •) í•œê¸€ IME (ì¡°í•©/ë¶„í•´) ë¡œì§ ---

        // (1) í•œê¸€ ìƒìˆ˜
        const CHOSEONG = ['ã„±', 'ã„²', 'ã„´', 'ã„·', 'ã„¸', 'ã„¹', 'ã…', 'ã…‚', 'ã…ƒ', 'ã……', 'ã…†', 'ã…‡', 'ã…ˆ', 'ã…‰', 'ã…Š', 'ã…‹', 'ã…Œ', 'ã…', 'ã…'];
        const JUNGSEONG = ['ã…', 'ã…', 'ã…‘', 'ã…’', 'ã…“', 'ã…”', 'ã…•', 'ã…–', 'ã…—', 'ã…˜', 'ã…™', 'ã…š', 'ã…›', 'ã…œ', 'ã…', 'ã…', 'ã…Ÿ', 'ã… ', 'ã…¡', 'ã…¢', 'ã…£'];
        const JONGSEONG = ['', 'ã„±', 'ã„²', 'ã„³', 'ã„´', 'ã„µ', 'ã„¶', 'ã„·', 'ã„¹', 'ã„º', 'ã„»', 'ã„¼', 'ã„½', 'ã„¾', 'ã„¿', 'ã…€', 'ã…', 'ã…‚', 'ã…„', 'ã……', 'ã…†', 'ã…‡', 'ã…ˆ', 'ã…Š', 'ã…‹', 'ã…Œ', 'ã…', 'ã…'];
        
        // (2) ë³µí•© ììŒ/ëª¨ìŒ (í‚¤ ì…ë ¥ ê¸°ì¤€)
        const COMPLEX_JAMO_KEY = {
            'ã„±ã……': 'ã„³', 'ã„´ã…ˆ': 'ã„µ', 'ã„´ã…': 'ã„¶', 'ã„¹ã„±': 'ã„º', 'ã„¹ã…': 'ã„»', 'ã„¹ã…‚': 'ã„¼', 'ã„¹ã……': 'ã„½', 'ã„¹ã…Œ': 'ã„¾', 'ã„¹ã…': 'ã„¿', 'ã„¹ã…': 'ã…€', 'ã…‚ã……': 'ã…„',
            'ã…—ã…': 'ã…˜', 'ã…—ã…': 'ã…™', 'ã…—ã…£': 'ã…š', 'ã…œã…“': 'ã…', 'ã…œã…”': 'ã…', 'ã…œã…£': 'ã…Ÿ', 'ã…¡ã…£': 'ã…¢'
        };
        
        // (3) ë³µí•© ììŒ/ëª¨ìŒ ë¶„í•´ (ì‚­ì œ ê¸°ì¤€)
        const DECOMPOSE_COMPLEX_JAMO = {
            'ã„³': ['ã„±', 'ã……'], 'ã„µ': ['ã„´', 'ã…ˆ'], 'ã„¶': ['ã„´', 'ã…'], 'ã„º': ['ã„¹', 'ã„±'], 'ã„»': ['ã„¹', 'ã…'], 'ã„¼': ['ã„¹', 'ã…‚'], 'ã„½': ['ã„¹', 'ã……'], 'ã„¾': ['ã„¹', 'ã…Œ'], 'ã„¿': ['ã„¹', 'ã…'], 'ã…€': ['ã„¹', 'ã…'], 'ã…„': ['ã…‚', 'ã……'],
            'ã…˜': ['ã…—', 'ã…'], 'ã…™': ['ã…—', 'ã…'], 'ã…š': ['ã…—', 'ã…£'], 'ã…': ['ã…œ', 'ã…“'], 'ã…': ['ã…œ', 'ã…”'], 'ã…Ÿ': ['ã…œ', 'ã…£'], 'ã…¢': ['ã…¡', 'ã…£']
        };

        // (4) ê¸€ì ì½”ë“œ ê³„ì‚°
        const HANGUL_START = 0xAC00; // 'ê°€'
        const HANGUL_END = 0xD7A3;   // 'í£'
        
        /**
         * ì´ˆ/ì¤‘/ì¢…ì„± ì¸ë±ìŠ¤ë¡œ í•œê¸€ ê¸€ì ë§Œë“¤ê¸°
         */
        function compose(choIdx, jungIdx, jongIdx) {
            return String.fromCharCode(HANGUL_START + (choIdx * 21 * 28) + (jungIdx * 28) + jongIdx);
        }

        /**
         * í•œê¸€ ê¸€ìë¥¼ ì´ˆ/ì¤‘/ì¢…ì„± ì¸ë±ìŠ¤ë¡œ ë¶„í•´
         */
        function decompose(char) {
            const code = char.charCodeAt(0);
            if (code < HANGUL_START || code > HANGUL_END) {
                return null; // í•œê¸€ ìŒì ˆì´ ì•„ë‹˜
            }
            const unicode = code - HANGUL_START;
            const jongIdx = unicode % 28;
            const jungIdx = ((unicode - jongIdx) / 28) % 21;
            const choIdx = Math.floor(((unicode - jongIdx) / 28) / 21);
            return [choIdx, jungIdx, jongIdx];
        }
        
        /**
         * ê°€ìƒ í‚¤ë³´ë“œ ì…ë ¥ ì²˜ë¦¬ (v2)
         */
        function typeHangul(key) {
            const val = answerInputEl.value;
            const lastChar = val.slice(-1);
            
            const isJung = JUNGSEONG.includes(key); // ìƒˆë¡œ ì…ë ¥ëœ í‚¤ê°€ ëª¨ìŒì¸ê°€?
            const isJong = JONGSEONG.includes(key); // ìƒˆë¡œ ì…ë ¥ëœ í‚¤ê°€ ë°›ì¹¨ ê°€ëŠ¥ ììŒì¸ê°€? (ì´ˆì„±ë„ ê²¸í•¨)

            // Shiftê°€ ëˆŒë¦° ìƒíƒœì˜€ë‹¤ë©´ ì›ë˜ëŒ€ë¡œ ë³µì›
            if (isShifted) toggleShift();

            // 1. ì…ë ¥ì°½ì´ ë¹„ì—ˆê±°ë‚˜, ë§ˆì§€ë§‰ ê¸€ìê°€ ì™„ì„±í˜• í•œê¸€ì´ ì•„ë‹Œ ê²½ìš° (ì˜ˆ: 'ã……')
            if (!lastChar || !decompose(lastChar)) {
                // 1a. ë§ˆì§€ë§‰ ê¸€ìê°€ ììŒ(ì˜ˆ: 'ã……')ì´ê³ , ìƒˆ í‚¤ê°€ ëª¨ìŒ(ì˜ˆ: 'ã…—')ì¼ ë•Œ
                if (CHOSEONG.includes(lastChar) && isJung) {
                    const choIdx = CHOSEONG.indexOf(lastChar);
                    const jungIdx = JUNGSEONG.indexOf(key);
                    answerInputEl.value = val.slice(0, -1) + compose(choIdx, jungIdx, 0); // 'ì†Œ'
                }
                // 1b. ê·¸ ì™¸ (ì˜ˆ: 'ã……' + 'ã„±' -> 'ã……ã„±', 'ã…—' + 'ã…' -> 'ã…—ã…')
                else {
                    answerInputEl.value += key;
                }
                return;
            }

            // --- 2. ë§ˆì§€ë§‰ ê¸€ìê°€ ì™„ì„±í˜• í•œê¸€ì¼ ë•Œ (ì˜ˆ: 'ì†Œ', 'ì†') ---
            const [choIdx, jungIdx, jongIdx] = decompose(lastChar);

            // 2a. [ì´ˆ+ì¤‘] ìƒíƒœ (ë°›ì¹¨ ì—†ìŒ. ì˜ˆ: 'ì†Œ')
            if (jongIdx === 0) {
                const jung = JUNGSEONG[jungIdx];
                const combinedJung = COMPLEX_JAMO_KEY[jung + key]; // ë³µí•© ëª¨ìŒ ì‹œë„ (ì˜ˆ: 'ã…—' + 'ã…' -> 'ã…˜')
                
                // 2a-i. ë³µí•© ëª¨ìŒ ì¡°í•© (ì˜ˆ: 'ì˜¤' + 'ã…' -> 'ì™€')
                if (isJung && combinedJung) {
                    const newJungIdx = JUNGSEONG.indexOf(combinedJung);
                    answerInputEl.value = val.slice(0, -1) + compose(choIdx, newJungIdx, 0);
                }
                // 2a-ii. ë°›ì¹¨ ì¶”ê°€ (ì˜ˆ: 'ì†Œ' + 'ã…' -> 'ì†¦')
                else if (isJong) {
                    const newJongIdx = JONGSEONG.indexOf(key);
                    if (newJongIdx > 0) { // JONGSEONG[0]ëŠ” ''(ë¹ˆê°’)ì´ë¯€ë¡œ ì œì™¸
                         answerInputEl.value = val.slice(0, -1) + compose(choIdx, jungIdx, newJongIdx);
                    } else {
                         answerInputEl.value += key;
                    }
                }
                // 2a-iii. ê·¸ ì™¸ (ì˜ˆ: 'ì†Œ' + 'ã…' -> 'ì†Œã…')
                else {
                    answerInputEl.value += key;
                }
            }
            // 2b. [ì´ˆ+ì¤‘+ì¢…] ìƒíƒœ (ë°›ì¹¨ ìˆìŒ. ì˜ˆ: 'ì†¦')
            else {
                const jong = JONGSEONG[jongIdx];
                const combinedJong = COMPLEX_JAMO_KEY[jong + key]; // ë³µí•© ë°›ì¹¨ ì‹œë„ (ì˜ˆ: 'ã„¹' + 'ã„±' -> 'ã„º')

                // 2b-i. ìƒˆ í‚¤ê°€ ëª¨ìŒì¼ ë•Œ (ì˜ˆ: 'ì†¦' + 'ã…' -> 'ì†Œ' + 'íŒŒ')
                if (isJung) {
                    let lastCharJong, newCharCho; // ë°›ì¹¨ ë¶„ë¦¬
                    const decomposedJong = DECOMPOSE_COMPLEX_JAMO[jong]; // (ì˜ˆ: 'ã„º' -> ['ã„¹', 'ã„±'])
                    
                    if (decomposedJong) { // ë³µí•© ë°›ì¹¨ì¸ ê²½ìš°
                        lastCharJong = decomposedJong[0];
                        newCharCho = decomposedJong[1];
                    } else { // í™‘ë°›ì¹¨ì¸ ê²½ìš°
                        lastCharJong = '';
                        newCharCho = jong;
                    }

                    const newLastJongIdx = JONGSEONG.indexOf(lastCharJong);
                    const newCharChoIdx = CHOSEONG.indexOf(newCharCho);
                    const newCharJungIdx = JUNGSEONG.indexOf(key);

                    answerInputEl.value = val.slice(0, -1) + 
                                        compose(choIdx, jungIdx, newLastJongIdx) + 
                                        compose(newCharChoIdx, newCharJungIdx, 0);
                }
                // 2b-ii. ìƒˆ í‚¤ê°€ ììŒì¼ ë•Œ (ë³µí•© ë°›ì¹¨ ì‹œë„. ì˜ˆ: 'ì‹' + 'ã……' -> 'ì‹Ÿ')
                else if (isJong && combinedJong && JONGSEONG.includes(combinedJong)) {
                    const newJongIdx = JONGSEONG.indexOf(combinedJong);
                    answerInputEl.value = val.slice(0, -1) + compose(choIdx, jungIdx, newJongIdx);
                }
                // 2b-iii. ê·¸ ì™¸ (ì˜ˆ: 'ì†¦' + 'ã…‹' -> 'ì†¦ã…‹')
                else {
                    answerInputEl.value += key;
                }
            }
        }
        
        /**
         * í•œê¸€ ì§€ìš°ê¸° (Backspace) ì²˜ë¦¬ (v2)
         */
        function handleBackspace() {
            const val = answerInputEl.value;
            if (val.length === 0) return;

            const lastChar = val.slice(-1);
            const decomposed = decompose(lastChar);
            
            // 1. ë§ˆì§€ë§‰ ê¸€ìê°€ í•œê¸€ ìŒì ˆì´ ì•„ë‹Œ ê²½ìš° (ì˜ˆ: 'ã……')
            if (!decomposed) {
                answerInputEl.value = val.slice(0, -1);
                return;
            }

            const [choIdx, jungIdx, jongIdx] = decomposed;
            
            // 2. [ì´ˆ+ì¤‘+ì¢…] ìƒíƒœ (ì˜ˆ: 'ì‚¶')
            if (jongIdx > 0) {
                const jong = JONGSEONG[jongIdx];
                const decomposedJong = DECOMPOSE_COMPLEX_JAMO[jong]; // (ì˜ˆ: 'ã„º' -> ['ã„¹', 'ã„±'])

                // 2a. ë³µí•© ë°›ì¹¨ ë¶„í•´ (ì˜ˆ: 'ì‚¶' -> 'ì‚´')
                if (decomposedJong) {
                    const newJongIdx = JONGSEONG.indexOf(decomposedJong[0]); // 'ã„¹'
                    answerInputEl.value = val.slice(0, -1) + compose(choIdx, jungIdx, newJongIdx);
                } 
                // 2b. í™‘ ë°›ì¹¨ ì œê±° (ì˜ˆ: 'ì‚´' -> 'ì‚¬')
                else {
                    answerInputEl.value = val.slice(0, -1) + compose(choIdx, jungIdx, 0);
                }
            }
            // 3. [ì´ˆ+ì¤‘] ìƒíƒœ (ì˜ˆ: 'ì‚¬', 'ì™€')
            else {
                const jung = JUNGSEONG[jungIdx];
                const decomposedJung = DECOMPOSE_COMPLEX_JAMO[jung]; // (ì˜ˆ: 'ã…˜' -> ['ã…—', 'ã…'])

                // 3a. ë³µí•© ëª¨ìŒ ë¶„í•´ (ì˜ˆ: 'ì™€' -> 'ì˜¤')
                if (decomposedJung) {
                    const newJungIdx = JUNGSEONG.indexOf(decomposedJung[0]); // 'ã…—'
                    answerInputEl.value = val.slice(0, -1) + compose(choIdx, newJungIdx, 0);
                }
                // 3b. í™‘ ëª¨ìŒ ì œê±° (ì˜ˆ: 'ì˜¤' -> 'ã…‡')
                else {
                    answerInputEl.value = val.slice(0, -1) + CHOSEONG[choIdx];
                }
            }
        }
        
        /**
         * Shift í‚¤ í† ê¸€ ë¡œì§ (v3 - ë²„ê·¸ ìˆ˜ì •)
         */
        let isShifted = false;
        const shiftKeyEl = document.querySelector('.kbd-key[data-key="shift"]');
        const shiftableKeyEls = document.querySelectorAll('.kbd-key[data-shift]');
        
        function toggleShift() {
            isShifted = !isShifted;
            shiftKeyEl.classList.toggle('shift-active', isShifted);
            
            shiftableKeyEls.forEach(keyEl => {
                 // data-keyëŠ” 'ã…‚' (ë¶ˆë³€)
                 const originalKey = keyEl.dataset.key; 
                 // data-shiftëŠ” 'ã…ƒ' (ë¶ˆë³€)
                 const shiftKey = keyEl.dataset.shift; 
                 
                 if (isShifted) {
                     keyEl.textContent = shiftKey; // ë³´ì´ëŠ” ê²ƒë§Œ 'ã…ƒ'ë¡œ
                 } else {
                     keyEl.textContent = originalKey; // ë³´ì´ëŠ” ê²ƒë§Œ 'ã…‚'ë¡œ
                 }
                 // data-key ì†ì„± ìì²´ëŠ” ì ˆëŒ€ ê±´ë“œë¦¬ì§€ ì•ŠìŒ
            });
        }

        // --- 5. ê²Œì„ ì‹œì‘ ---
        startGame();

    </script>
</body>
</html>
