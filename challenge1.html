<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <!-- [!!!] ìˆ˜ì •: ì œëª© ë³€ê²½ -->
    <title>ì¢…í•© ì´ˆì„± í€´ì¦ˆ (30ë¬¸ì œ)</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700&display=swap');

        /* --- ê¸°ë³¸ ìŠ¤íƒ€ì¼ --- */
        * {
            box-sizing: border-box; 
        }
        
        html, body {
            height: 100%; 
            max-height: 100%; 
            font-family: 'Noto Sans KR', sans-serif;
            background-color: #f5f5f5; 
            color: #333;
            margin: 0;
            overflow: hidden; 
        }

        body {
            display: flex;
            flex-direction: column; 
            justify-content: center; 
            padding: 5px 0;
        }

        /* --- ê²Œì„ ì»¨í…Œì´ë„ˆ --- */
        #game-container {
            background-color: #ffffff;
            border-radius: 12px; 
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08); 
            padding: 10px 15px; 
            border: 1px solid #ddd;
            display: flex;
            flex-direction: column;
            margin-bottom: 5px; 
        }

        /* --- ìƒíƒœ í‘œì‹œì¤„ --- */
        #status-bar {
            display: flex;
            justify-content: space-between;
            font-size: 0.9rem; 
            font-weight: 700;
            color: #555;
            margin-bottom: 8px; 
        }

        /* --- ì´ˆì„± --- */
        #choseong-display {
            font-size: 2.5rem; 
            font-weight: 700;
            color: #6a1b9a;
            letter-spacing: 10px;
            margin-bottom: 8px; 
            padding: 10px 0; 
            background-color: #f8f9fa;
            border-radius: 8px; 
            text-align: center;
        }

        /* --- íƒ€ì´ë¨¸ --- */
        #timer-bar-container {
            width: 100%;
            height: 6px; 
            background-color: #e9ecef;
            border-radius: 3px;
            overflow: hidden;
        }

        #timer-bar {
            width: 100%;
            height: 100%;
            background-color: #4caf50;
            transition: width 1s linear;
        }

        /* --- íŒíŠ¸ ì˜ì—­ --- */
        #hint-area {
            min-height: 80px; 
            margin-top: 8px; 
            display: flex;
            flex-direction: column; 
            justify-content: center;
            align-items: center;
            border: 2px dashed #ddd;
            border-radius: 8px; 
            padding: 5px; 
            text-align: center;
        }

        .hint-box { font-size: 0.85rem; color: #555; } 
        /* [!!!] ìˆ˜ì •: íŒíŠ¸ë³„ ìŠ¤íƒ€ì¼ ì¶”ê°€ */
        #topic-hint { 
            font-size: 1.1rem; 
            font-weight: 700; 
            color: #007bff; /* ì£¼ì œ íŒíŠ¸ (íŒŒë‘) */
        }
        #image-hint { 
            font-size: 2.5rem; /* ì´ëª¨ì§€ íŒíŠ¸ (í¼) */
        }
        #image-hint.hidden, #topic-hint.hidden { 
            display: none; 
        }


        /* --- í”¼ë“œë°± ë©”ì‹œì§€ --- */
        .feedback {
            font-size: 0.9rem; 
            font-weight: 700;
            padding: 5px; 
            display: none; 
            border-radius: 6px; 
            text-align: center;
            width: 100%;
        }
        .feedback.correct { color: #28a745; background-color: #e6f7ec; }
        .feedback.wrong { color: #dc3545; background-color: #fdeeee; }
        .feedback.info { color: #555; background-color: #f0f0f0; }
        
        /* --- ì…ë ¥ ì˜ì—­ --- */
        #input-area {
            margin-top: 8px; 
            display: flex;
            gap: 5px; 
        }

        #answer-input {
            flex-grow: 1;
            min-width: 0;
            padding: 10px; 
            font-size: 1rem; 
            border: 2px solid #ced4da;
            border-radius: 6px; 
            transition: border-color 0.3s;
            text-align: center; 
            font-weight: 700;
            color: #333;
            font-family: 'Noto Sans KR', sans-serif;
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
        }
        #answer-input:focus { border-color: #6a1b9a; outline: none; }
        #answer-input[readonly] { caret-color: transparent; }

        #submit-btn {
            flex-shrink: 0;
            padding: 10px 15px; 
            font-size: 1rem; 
            font-weight: 700;
            background-color: #6a1b9a;
            color: white;
            border: none;
            border-radius: 6px; 
            cursor: pointer;
            transition: background-color 0.3s;
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
        }
        #submit-btn:hover { background-color: #4a148c; }

        /* --- ê°€ìƒ í‚¤ë³´ë“œ --- */
        #virtual-keyboard {
            margin-top: 5px; 
            padding: 5px; 
            background-color: #e9ecef;
            border-radius: 8px; 
            flex-shrink: 0; 
        }
        
        .kbd-row {
            display: flex;
            justify-content: center;
            gap: 3px; 
            margin-bottom: 3px; 
        }
        .kbd-row:last-child { margin-bottom: 0; }

        .kbd-key {
            font-family: 'Noto Sans KR', sans-serif;
            font-size: 0.9rem; 
            font-weight: 700;
            background-color: #ffffff;
            color: #333;
            border: none;
            border-radius: 5px; 
            padding: 8px 0; 
            flex-grow: 1; 
            flex-basis: 0;
            min-width: 26px; 
            
            cursor: pointer;
            user-select: none;
            -webkit-user-select: none; 
            
            box-shadow: 0 2px 2px rgba(0, 0, 0, 0.1);
            transition: background-color 0.1s, transform 0.1s;
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
        }
        .kbd-key:active { background-color: #ddd; transform: translateY(1px); }
        
        .kbd-key.special {
            flex-grow: 1.5;
            background-color: #adb5bd;
            color: white;
            font-size: 0.7rem; 
        }
        .kbd-key.special:active { background-color: #868e96; }
        .kbd-key.shift-active { background-color: #a5b4fc; color: #1e3a8a; }

        /* --- ê²Œì„ ì¢…ë£Œ ì˜¤ë²„ë ˆì´ --- */
        #game-over-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            justify-content: center;
            align-items: center;
            z-index: 100;
        }

        #game-over-box {
            background-color: white;
            padding: 30px 40px; 
            border-radius: 15px; 
            text-align: center;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
            animation: zoomIn 0.5s ease;
            width: 90%;
            max-width: 400px;
        }
        #game-over-box h2 { font-size: 2rem; color: #6a1b9a; margin-top: 0; } 
        #game-over-box p { font-size: 1.2rem; margin-bottom: 25px; } 
        #restart-btn {
            padding: 12px 25px; 
            font-size: 1.1rem; 
            font-weight: 700;
            background-color: #28a745;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.3s;
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
        }
        #restart-btn:hover { background-color: #218838; }
        
        @keyframes zoomIn {
            from { transform: scale(0.5); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }

    </style>
</head>
<body>

    <!-- ê²Œì„ ì»¨í…ì¸  -->
    <div id="game-container">
        <div id="status-bar">
            <!-- [!!!] ìˆ˜ì •: 30ë¬¸ì œë¡œ ë³€ê²½ -->
            <span id="question-counter">ë¬¸ì œ 1 / 30</span>
            <span id="total-score">ì´ ì ìˆ˜: 0 ì </span>
        </div>
        <div id="question-area">
            <div id="choseong-display">...</div>
            <div id="timer-bar-container">
                <div id="timer-bar"></div>
            </div>
        </div>

        <div id="hint-area">
            <!-- [!!!] ìˆ˜ì •: íŒíŠ¸ ìš”ì†Œ ì¶”ê°€ ë° í…ìŠ¤íŠ¸ ë³€ê²½ -->
            <div id="topic-hint" class="hint-box hidden"></div>
            <div id="image-hint" class="hint-box hidden"></div>
            <div id="initial-hint-text" class="hint-box">7ì´ˆ í›„ì— ì£¼ì œ íŒíŠ¸ê°€ ë‚˜ì˜µë‹ˆë‹¤. (ì´ 21ì´ˆ)</div>
            
            <div id="feedback-correct" class="feedback correct">ì •ë‹µì…ë‹ˆë‹¤! (+0ì )</div>
            <div id="feedback-wrong" class="feedback wrong">í‹€ë ¸ìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•˜ì„¸ìš”.</div>
            <div id="feedback-timeout" class="feedback info">ì‹œê°„ ì´ˆê³¼! ì •ë‹µ: </div>
        </div>

        <div id="input-area">
            <input type="text" id="answer-input" placeholder="ì •ë‹µì„ ì…ë ¥í•˜ì„¸ìš”...">
            <button id="submit-btn">í™•ì¸</button>
        </div>
    </div>
    
    <!-- ê°€ìƒ í‚¤ë³´ë“œ HTML (ì´ì „ê³¼ ë™ì¼) -->
    <div id="virtual-keyboard">
        <div class="kbd-row" id="kbd-row-1">
            <button class="kbd-key" data-key="ã…‚" data-shift="ã…ƒ">ã…‚</button>
            <button class="kbd-key" data-key="ã…ˆ" data-shift="ã…‰">ã…ˆ</button>
            <button class="kbd-key" data-key="ã„·" data-shift="ã„¸">ã„·</button>
            <button class="kbd-key" data-key="ã„±" data-shift="ã„²">ã„±</button>
            <button class="kbd-key" data-key="ã……" data-shift="ã…†">ã……</button>
            <button class="kbd-key" data-key="ã…›">ã…›</button>
            <button class="kbd-key" data-key="ã…•">ã…•</button>
            <button class="kbd-key" data-key="ã…‘">ã…‘</button>
            <button class="kbd-key" data-key="ã…" data-shift="ã…’">ã…</button>
            <button class="kbd-key" data-key="ã…”" data-shift="ã…–">ã…”</button>
        </div>
        <div class="kbd-row" id="kbd-row-2">
            <button class="kbd-key" data-key="ã…">ã…</button>
            <button class="kbd-key" data-key="ã„´">ã„´</button>
            <button class="kbd-key" data-key="ã…‡">ã…‡</button>
            <button class="kbd-key" data-key="ã„¹">ã„¹</button>
            <button class="kbd-key" data-key="ã…">ã…</button>
            <button class="kbd-key" data-key="ã…—">ã…—</button>
            <button class="kbd-key" data-key="ã…“">ã…“</button>
            <button class="kbd-key" data-key="ã…">ã…</button>
            <button class="kbd-key" data-key="ã…£">ã…£</button>
        </div>
        <div class="kbd-row" id="kbd-row-3">
            <button class="kbd-key" data-key="shift">Shift</button>
            <button class="kbd-key" data-key="ã…‹">ã…‹</button>
            <button class="kbd-key" data-key="ã…Œ">ã…Œ</button>
            <button class="kbd-key" data-key="ã…Š">ã…Š</button>
            <button class="kbd-key" data-key="ã…">ã…</button>
            <button class="kbd-key" data-key="ã… ">ã… </button>
            <button class="kbd-key" data-key="ã…œ">ã…œ</button>
            <button class="kbd-key" data-key="ã…¡">ã…¡</button>
            <button class="kbd-key special" data-key="del">ì§€ìš°ê¸°</button>
        </div>
        <div class="kbd-row" id="kbd-row-4">
            <button class="kbd-key special" data-key="enter">í™•ì¸</button>
        </div>
    </div>
    
    <!-- ê²Œì„ ì¢…ë£Œ í™”ë©´ -->
    <div id="game-over-overlay">
        <div id="game-over-box">
            <h2>ê²Œì„ ì¢…ë£Œ!</h2>
            <p id="final-score">ìµœì¢… ì ìˆ˜: 0 ì </p>
            <button id="restart-btn">ë‹¤ì‹œ ì‹œì‘í•˜ê¸°</button>
        </div>
    </div>

    <script>
        // --- 1. ë°ì´í„° ---
        // [!!!] ìˆ˜ì •: 140ê°œ ë‹¨ì–´ ë§ˆìŠ¤í„° ë±…í¬
        const masterQuestionBank = [
            // 1. ê°€êµ¬
            { choseong: 'ã…Šã„·', answer: 'ì¹¨ëŒ€', imageHint: 'ğŸ›ï¸', topic: 'ê°€êµ¬' },
            { choseong: 'ã…‡ã…ˆ', answer: 'ì˜ì', imageHint: 'ğŸª‘', topic: 'ê°€êµ¬' },
            { choseong: 'ã…Šã……', answer: 'ì±…ìƒ', imageHint: 'ğŸ§‘â€ğŸ’»', topic: 'ê°€êµ¬' },
            { choseong: 'ã……ã…Œ', answer: 'ì‹íƒ', imageHint: 'ğŸ½ï¸', topic: 'ê°€êµ¬' },
            { choseong: 'ã……ã„¹', answer: 'ì„œë', imageHint: 'ğŸ—„ï¸', topic: 'ê°€êµ¬' },
            { choseong: 'ã……ã…', answer: 'ì†ŒíŒŒ', imageHint: 'ğŸ›‹ï¸', topic: 'ê°€êµ¬' },
            { choseong: 'ã…‡ã…ˆ', answer: 'ì˜·ì¥', imageHint: 'ğŸ‘š', topic: 'ê°€êµ¬' },
            { choseong: 'ã…Šã„²ã…‡', answer: 'ì±…ê½‚ì´', imageHint: 'ğŸ“š', topic: 'ê°€êµ¬' },
            { choseong: 'ã„±ã…‡', answer: 'ê±°ìš¸', imageHint: 'ğŸª', topic: 'ê°€êµ¬' },
            { choseong: 'ã…Œã…ˆ', answer: 'íƒì', imageHint: 'â˜•ï¸', topic: 'ê°€êµ¬' },
            // 2. ë™ë¬¼
            { choseong: 'ã„±', answer: 'ê°œ', imageHint: 'ğŸ¶', topic: 'ë™ë¬¼' },
            { choseong: 'ã„±ã…‡ã…‡', answer: 'ê³ ì–‘ì´', imageHint: 'ğŸ±', topic: 'ë™ë¬¼' },
            { choseong: 'ã……ã…ˆ', answer: 'ì‚¬ì', imageHint: 'ğŸ¦', topic: 'ë™ë¬¼' },
            { choseong: 'ã…Œã„²', answer: 'í† ë¼', imageHint: 'ğŸ°', topic: 'ë™ë¬¼' },
            { choseong: 'ã…ã„¹ã…‡', answer: 'í˜¸ë‘ì´', imageHint: 'ğŸ¯', topic: 'ë™ë¬¼' },
            { choseong: 'ã„·ã…ˆ', answer: 'ë¼ì§€', imageHint: 'ğŸ·', topic: 'ë™ë¬¼' },
            { choseong: 'ã…‡ã„¹', answer: 'ì˜¤ë¦¬', imageHint: 'ğŸ¦†', topic: 'ë™ë¬¼' },
            { choseong: 'ã…‡', answer: 'ì–‘', imageHint: 'ğŸ‘', topic: 'ë™ë¬¼' },
            { choseong: 'ã……', answer: 'ì†Œ', imageHint: 'ğŸ®', topic: 'ë™ë¬¼' },
            { choseong: 'ã…', answer: 'ë§', imageHint: 'ğŸ´', topic: 'ë™ë¬¼' },
            // 3. êµ­ê°€
            { choseong: 'ã…ã„±', answer: 'í•œêµ­', imageHint: 'ğŸ‡°ğŸ‡·', topic: 'êµ­ê°€' },
            { choseong: 'ã…ã„¹ã……', answer: 'í”„ë‘ìŠ¤', imageHint: 'ğŸ‡«ğŸ‡·', topic: 'êµ­ê°€' },
            { choseong: 'ã…‡ã…‚', answer: 'ì¼ë³¸', imageHint: 'ğŸ‡¯ğŸ‡µ', topic: 'êµ­ê°€' },
            { choseong: 'ã…ˆã„±', answer: 'ì¤‘êµ­', imageHint: 'ğŸ‡¨ğŸ‡³', topic: 'êµ­ê°€' },
            { choseong: 'ã„·ã…‡', answer: 'ë…ì¼', imageHint: 'ğŸ‡©ğŸ‡ª', topic: 'êµ­ê°€' },
            { choseong: 'ã…‡ã„±', answer: 'ì˜êµ­', imageHint: 'ğŸ‡¬ğŸ‡§', topic: 'êµ­ê°€' },
            { choseong: 'ã…ã„±', answer: 'ë¯¸êµ­', imageHint: 'ğŸ‡ºğŸ‡¸', topic: 'êµ­ê°€' },
            { choseong: 'ã„¹ã……ã…‡', answer: 'ëŸ¬ì‹œì•„', imageHint: 'ğŸ‡·ğŸ‡º', topic: 'êµ­ê°€' },
            { choseong: 'ã……ã…ã…‡', answer: 'ìŠ¤í˜ì¸', imageHint: 'ğŸ‡ªğŸ‡¸', topic: 'êµ­ê°€' },
            { choseong: 'ã…‡ã…ˆã…Œ', answer: 'ì´ì§‘íŠ¸', imageHint: 'ğŸ‡ªğŸ‡¬', topic: 'êµ­ê°€' },
            // 4. ê°€ì¡± (ì¤‘ë³µ í—ˆìš© ë²„ì „ì´ì§€ë§Œ, ì—¬ê¸°ì„œëŠ” ë…ë¦½ ë¬¸ì œë¡œ ì·¨ê¸‰)
            { choseong: 'ã…‡ã…ƒ', answer: 'ì•„ë¹ ', imageHint: 'ğŸ‘¨', topic: 'ê°€ì¡±' },
            { choseong: 'ã…‡ã…', answer: 'ì—„ë§ˆ', imageHint: 'ğŸ§‘', topic: 'ê°€ì¡±' },
            { choseong: 'ã…‡ã„·', answer: 'ì•„ë“¤', imageHint: 'ğŸ‘¦', topic: 'ê°€ì¡±' },
            { choseong: 'ã„¸', answer: 'ë”¸', imageHint: 'ğŸ‘§', topic: 'ê°€ì¡±' },
            { choseong: 'ã…ã…ã„´', answer: 'í• ë¨¸ë‹ˆ', imageHint: 'ğŸ‘µ', topic: 'ê°€ì¡±' },
            { choseong: 'ã…ã…‡ã…‚ã…ˆ', answer: 'í• ì•„ë²„ì§€', imageHint: 'ğŸ‘´', topic: 'ê°€ì¡±' },
            { choseong: 'ã…‡ã„´', answer: 'ì–¸ë‹ˆ', imageHint: 'ğŸ‘±â€â™€ï¸', topic: 'ê°€ì¡±' },
            { choseong: 'ã„´ã„´', answer: 'ëˆ„ë‚˜', imageHint: 'ğŸ‘±â€â™€ï¸', topic: 'ê°€ì¡±' },
            { choseong: 'ã…', answer: 'í˜•', imageHint: 'ğŸ‘±', topic: 'ê°€ì¡±' },
            { choseong: 'ã…‡ã…ƒ', answer: 'ì˜¤ë¹ ', imageHint: 'ğŸ‘±', topic: 'ê°€ì¡±' },
            // 5. íŒ¨ì…˜
            { choseong: 'ã…Œã……ã…Š', answer: 'í‹°ì…”ì¸ ', imageHint: 'ğŸ‘•', topic: 'íŒ¨ì…˜' },
            { choseong: 'ã…‚ã…ˆ', answer: 'ë°”ì§€', imageHint: 'ğŸ‘–', topic: 'íŒ¨ì…˜' },
            { choseong: 'ã……ã…‚', answer: 'ì‹ ë°œ', imageHint: 'ğŸ‘Ÿ', topic: 'íŒ¨ì…˜' },
            { choseong: 'ã…ã…ˆ', answer: 'ëª¨ì', imageHint: 'ğŸ§¢', topic: 'íŒ¨ì…˜' },
            { choseong: 'ã…‡ã…ã……', answer: 'ì›í”¼ìŠ¤', imageHint: 'ğŸ‘—', topic: 'íŒ¨ì…˜' },
            { choseong: 'ã…‹ã…Œ', answer: 'ì½”íŠ¸', imageHint: 'ğŸ§¥', topic: 'íŒ¨ì…˜' },
            { choseong: 'ã…ˆã„±', answer: 'ì¥ê°‘', imageHint: 'ğŸ§¤', topic: 'íŒ¨ì…˜' },
            { choseong: 'ã…ã„·ã„¹', answer: 'ëª©ë„ë¦¬', imageHint: 'ğŸ§£', topic: 'íŒ¨ì…˜' },
            { choseong: 'ã……ã…‡ã…‚', answer: 'ìˆ˜ì˜ë³µ', imageHint: 'ğŸ©±', topic: 'íŒ¨ì…˜' },
            { choseong: 'ã„±ã…‚', answer: 'ê°€ë°©', imageHint: 'ğŸ’', topic: 'íŒ¨ì…˜' },
            // 6. ê³¼ì¼
            { choseong: 'ã……ã„±', answer: 'ì‚¬ê³¼', imageHint: 'ğŸ', topic: 'ê³¼ì¼' },
            { choseong: 'ã…‚ã„´ã„´', answer: 'ë°”ë‚˜ë‚˜', imageHint: 'ğŸŒ', topic: 'ê³¼ì¼' },
            { choseong: 'ë”¸ã„±', answer: 'ë”¸ê¸°', imageHint: 'ğŸ“', topic: 'ê³¼ì¼' },
            { choseong: 'ã…ã„·', answer: 'í¬ë„', imageHint: 'ğŸ‡', topic: 'ê³¼ì¼' },
            { choseong: 'ã……ã…‚', answer: 'ìˆ˜ë°•', imageHint: 'ğŸ‰', topic: 'ê³¼ì¼' },
            { choseong: 'ã…‡ã„¹ã…ˆ', answer: 'ì˜¤ë Œì§€', imageHint: 'ğŸŠ', topic: 'ê³¼ì¼' },
            { choseong: 'ã„±', answer: 'ê·¤', imageHint: 'ğŸŠ', topic: 'ê³¼ì¼' },
            { choseong: 'ã„¹ã…', answer: 'ë ˆëª¬', imageHint: 'ğŸ‹', topic: 'ê³¼ì¼' },
            { choseong: 'ã…‚ã……ã…‡', answer: 'ë³µìˆ­ì•„', imageHint: 'ğŸ‘', topic: 'ê³¼ì¼' },
            { choseong: 'ã…Šã„¹', answer: 'ì²´ë¦¬', imageHint: 'ğŸ’', topic: 'ê³¼ì¼' },
            // 7. í•™êµ
            { choseong: 'ã…ã„±', answer: 'í•™êµ', imageHint: 'ğŸ«', topic: 'í•™êµ' },
            { choseong: 'ã……ã……ã„´', answer: 'ì„ ìƒë‹˜', imageHint: 'ğŸ‘¨â€ğŸ«', topic: 'í•™êµ' },
            { choseong: 'ã…ã……', answer: 'í•™ìƒ', imageHint: 'ğŸ§‘â€ğŸ“', topic: 'í•™êµ' },
            { choseong: 'ã…Šã……', answer: 'ì±…ìƒ', imageHint: 'ğŸ“’', topic: 'í•™êµ' },
            { choseong: 'ã…‡ã…ˆ', answer: 'ì˜ì', imageHint: 'ğŸª‘', topic: 'í•™êµ' },
            { choseong: 'ã…Š', answer: 'ì±…', imageHint: 'ğŸ“š', topic: 'í•™êµ' },
            { choseong: 'ã„±ã…Š', answer: 'ê³µì±…', imageHint: 'ğŸ—’ï¸', topic: 'í•™êµ' },
            { choseong: 'ã…‡ã…', answer: 'ì—°í•„', imageHint: 'âœï¸', topic: 'í•™êµ' },
            { choseong: 'ã…ˆã…‡ã„±', answer: 'ì§€ìš°ê°œ', imageHint: ' eraser', topic: 'í•™êµ' },
            { choseong: 'ã„±ã……', answer: 'êµì‹¤', imageHint: 'ğŸ§‘â€ğŸ«ğŸ‘©â€ğŸ“', topic: 'í•™êµ' },
            // 8. ìƒ‰ê¹”
            { choseong: 'ã…ƒã„±ã……', answer: 'ë¹¨ê°„ìƒ‰', imageHint: 'â¤ï¸', topic: 'ìƒ‰ê¹”' },
            { choseong: 'ã„´ã„¹ã……', answer: 'ë…¸ë€ìƒ‰', imageHint: 'ğŸ’›', topic: 'ìƒ‰ê¹”' },
            { choseong: 'ã…ã„¹ã……', answer: 'íŒŒë€ìƒ‰', imageHint: 'ğŸ’™', topic: 'ìƒ‰ê¹”' },
            { choseong: 'ã…Šã„¹ã……', answer: 'ì´ˆë¡ìƒ‰', imageHint: 'ğŸ’š', topic: 'ìƒ‰ê¹”' },
            { choseong: 'ã…‚ã„¹ã……', answer: 'ë³´ë¼ìƒ‰', imageHint: 'ğŸ’œ', topic: 'ìƒ‰ê¹”' },
            { choseong: 'ã…ã…‡ã……', answer: 'í•˜ì–€ìƒ‰', imageHint: 'ğŸ¤', topic: 'ìƒ‰ê¹”' },
            { choseong: 'ã„±ã…ˆã……', answer: 'ê²€ì •ìƒ‰', imageHint: 'ğŸ–¤', topic: 'ìƒ‰ê¹”' },
            { choseong: 'ã…‚ã…ã……', answer: 'ë¶„í™ìƒ‰', imageHint: 'ğŸ©·', topic: 'ìƒ‰ê¹”' },
            { choseong: 'ã…ˆã…ã……', answer: 'ì£¼í™©ìƒ‰', imageHint: 'ğŸ§¡', topic: 'ìƒ‰ê¹”' },
            { choseong: 'ã…ã……', answer: 'íšŒìƒ‰', imageHint: 'ğŸ©¶', topic: 'ìƒ‰ê¹”' },
            // 9. ì£¼ë°©
            { choseong: 'ã„´ã…ˆã„±', answer: 'ëƒ‰ì¥ê³ ', imageHint: 'ğŸ§Š', topic: 'ì£¼ë°©' },
            { choseong: 'ã…ˆã…ˆã„¹ã…‡ã…ˆ', answer: 'ì „ìë ˆì¸ì§€', imageHint: 'âš¡ï¸', topic: 'ì£¼ë°©' },
            { choseong: 'ã…‹', answer: 'ì¹¼', imageHint: 'ğŸ”ª', topic: 'ì£¼ë°©' },
            { choseong: 'ã„·ã…', answer: 'ë„ë§ˆ', imageHint: 'ğŸªµ', topic: 'ì£¼ë°©' },
            { choseong: 'ã„´ã…‚', answer: 'ëƒ„ë¹„', imageHint: 'ğŸ²', topic: 'ì£¼ë°©' },
            { choseong: 'ã…ã„¹ã…‡ã…', answer: 'í”„ë¼ì´íŒ¬', imageHint: 'ğŸ³', topic: 'ì£¼ë°©' },
            { choseong: 'ã…ˆã……', answer: 'ì ‘ì‹œ', imageHint: 'ğŸ½ï¸', topic: 'ì£¼ë°©' },
            { choseong: 'ã„±', answer: 'ì»µ', imageHint: 'â˜•ï¸', topic: 'ì£¼ë°©' },
            { choseong: 'ã……ã„±ã„¹', answer: 'ìˆŸê°€ë½', imageHint: 'ğŸ¥„', topic: 'ì£¼ë°©' },
            { choseong: 'ã…ˆã„±ã„¹', answer: 'ì “ê°€ë½', imageHint: 'ğŸ¥¢', topic: 'ì£¼ë°©' },
            // 10. ì‹ ì²´
            { choseong: 'ã…ã„¹', answer: 'ë¨¸ë¦¬', imageHint: 'ğŸ‘±', topic: 'ì‹ ì²´' },
            { choseong: 'ã„´', answer: 'ëˆˆ', imageHint: 'ğŸ‘€', topic: 'ì‹ ì²´' },
            { choseong: 'ã…‹', answer: 'ì½”', imageHint: 'ğŸ‘ƒ', topic: 'ì‹ ì²´' },
            { choseong: 'ã…‡', answer: 'ì…', imageHint: 'ğŸ‘„', topic: 'ì‹ ì²´' },
            { choseong: 'ã„±', answer: 'ê·€', imageHint: 'ğŸ‘‚', topic: 'ì‹ ì²´' },
            { choseong: 'ã……', answer: 'ì†', imageHint: 'ğŸ–ï¸', topic: 'ì‹ ì²´' },
            { choseong: 'ã…‚', answer: 'ë°œ', imageHint: 'ğŸ¦¶', topic: 'ì‹ ì²´' },
            { choseong: 'ã„·ã„¹', answer: 'ë‹¤ë¦¬', imageHint: 'ğŸ¦µ', topic: 'ì‹ ì²´' },
            { choseong: 'ã…‡ã„²', answer: 'ì–´ê¹¨', imageHint: 'ğŸ¤·', topic: 'ì‹ ì²´' },
            { choseong: 'ã…ã„¹', answer: 'ë¬´ë¦', imageHint: 'ğŸ¦µ', topic: 'ì‹ ì²´' },
            // 11. ìŠ¤í¬ì¸ 
            { choseong: 'ã…Šã„±', answer: 'ì¶•êµ¬', imageHint: 'âš½ï¸', topic: 'ìŠ¤í¬ì¸ ' },
            { choseong: 'ã…‡ã„±', answer: 'ì•¼êµ¬', imageHint: 'âš¾ï¸', topic: 'ìŠ¤í¬ì¸ ' },
            { choseong: 'ã„´ã„±', answer: 'ë†êµ¬', imageHint: 'ğŸ€', topic: 'ìŠ¤í¬ì¸ ' },
            { choseong: 'ã…‚ã„±', answer: 'ë°°êµ¬', imageHint: 'ğŸ', topic: 'ìŠ¤í¬ì¸ ' },
            { choseong: 'ã……ã…‡', answer: 'ìˆ˜ì˜', imageHint: 'ğŸŠ', topic: 'ìŠ¤í¬ì¸ ' },
            { choseong: 'ã…Œã„±ã„·', answer: 'íƒœê¶Œë„', imageHint: 'ğŸ¥‹', topic: 'ìŠ¤í¬ì¸ ' },
            { choseong: 'ã„±ã…', answer: 'ê³¨í”„', imageHint: 'ğŸŒï¸', topic: 'ìŠ¤í¬ì¸ ' },
            { choseong: 'ã…Œã„´ã……', answer: 'í…Œë‹ˆìŠ¤', imageHint: 'ğŸ¾', topic: 'ìŠ¤í¬ì¸ ' },
            { choseong: 'ã…Œã„±', answer: 'íƒêµ¬', imageHint: 'ğŸ“', topic: 'ìŠ¤í¬ì¸ ' },
            { choseong: 'ã„·ã„¹ã„±', answer: 'ë‹¬ë¦¬ê¸°', imageHint: 'ğŸƒ', topic: 'ìŠ¤í¬ì¸ ' },
            // 12. ì•…ê¸°
            { choseong: 'ã…ã…‡ã„´', answer: 'í”¼ì•„ë…¸', imageHint: 'ğŸ¹', topic: 'ì•…ê¸°' },
            { choseong: 'ã„±ã…Œ', answer: 'ê¸°íƒ€', imageHint: 'ğŸ¸', topic: 'ì•…ê¸°' },
            { choseong: 'ã…‚ã…‡ã…‡ã„¹', answer: 'ë°”ì´ì˜¬ë¦°', imageHint: 'ğŸ»', topic: 'ì•…ê¸°' },
            { choseong: 'ã„·ã„¹', answer: 'ë“œëŸ¼', imageHint: 'ğŸ¥', topic: 'ì•…ê¸°' },
            { choseong: 'ã…Œã„¹ã…', answer: 'íŠ¸ëŸ¼í«', imageHint: 'ğŸº', topic: 'ì•…ê¸°' },
            { choseong: 'ã…ã„¹ã…Œ', answer: 'í”Œë£¨íŠ¸', imageHint: 'ğŸ¶', topic: 'ì•…ê¸°' },
            { choseong: 'ã……ã……ã…', answer: 'ìƒ‰ì†Œí°', imageHint: 'ğŸ·', topic: 'ì•…ê¸°' },
            { choseong: 'ã…ã…', answer: 'í•˜í”„', imageHint: 'ğŸµ', topic: 'ì•…ê¸°' },
            { choseong: 'ã…Šã„¹', answer: 'ì²¼ë¡œ', imageHint: 'ğŸ»', topic: 'ì•…ê¸°' },
            { choseong: 'ã…‹ã„¹ã„¹ã„´', answer: 'í´ë¼ë¦¬ë„·', imageHint: 'ğŸ¼', topic: 'ì•…ê¸°' },
            // 13. ì§ì—…
            { choseong: 'ã…‡ã……', answer: 'ì˜ì‚¬', imageHint: 'ğŸ‘¨â€âš•ï¸', topic: 'ì§ì—…' },
            { choseong: 'ã„±ã…ã……', answer: 'ê°„í˜¸ì‚¬', imageHint: 'ğŸ‘©â€âš•ï¸', topic: 'ì§ì—…' },
            { choseong: 'ã……ã……ã„´', answer: 'ì„ ìƒë‹˜', imageHint: 'ğŸ‘¨â€ğŸ«', topic: 'ì§ì—…' },
            { choseong: 'ã„±ã…Šã„±', answer: 'ê²½ì°°ê´€', imageHint: 'ğŸ‘®', topic: 'ì§ì—…' },
            { choseong: 'ã……ã…‚ã„±', answer: 'ì†Œë°©ê´€', imageHint: 'ğŸ‘¨â€ğŸš’', topic: 'ì§ì—…' },
            { choseong: 'ã…‡ã„¹ã……', answer: 'ìš”ë¦¬ì‚¬', imageHint: 'ğŸ‘©â€ğŸ³', topic: 'ì§ì—…' },
            { choseong: 'ã…ã……', answer: 'ëª©ìˆ˜', imageHint: 'ğŸ”¨', topic: 'ì§ì—…' },
            { choseong: 'ã„´ã…‚', answer: 'ë†ë¶€', imageHint: 'ğŸ‘¨â€ğŸŒ¾', topic: 'ì§ì—…' },
            { choseong: 'ã„±ã……', answer: 'ê°€ìˆ˜', imageHint: 'ğŸ¤', topic: 'ì§ì—…' },
            { choseong: 'ã…ã„±', answer: 'í™”ê°€', imageHint: 'ğŸ¨', topic: 'ì§ì—…' },
             // 14. (10ê°œ ë‹¨ì–´ ëˆ„ë½ - ì›ë³¸ íŒŒì¼ í™•ì¸ í•„ìš”)
             // ì›ë³¸ 'ê°€êµ¬' í€´ì¦ˆì— 10ê°œê°€ ìˆì—ˆê³ , ë‚˜ë¨¸ì§€ë„ 10ê°œì”© ìƒì„±í–ˆìŠµë‹ˆë‹¤.
             // 1.ê°€êµ¬(10), 2.ë™ë¬¼(10), 3.êµ­ê°€(10), 4.ê°€ì¡±(10), 5.íŒ¨ì…˜(10), 6.ê³¼ì¼(10), 7.í•™êµ(10), 8.ìƒ‰ê¹”(10), 9.ì£¼ë°©(10), 10.ì‹ ì²´(10), 11.ìŠ¤í¬ì¸ (10), 12.ì•…ê¸°(10), 13.ì§ì—…(10)
             // ì•—, 13ê°œ ì„¸íŠ¸ * 10 = 130ê°œì…ë‹ˆë‹¤. 'ê°€ì¡± (ì—„ê²©)'ì€ ì¤‘ë³µì´ë¼ ëºìŠµë‹ˆë‹¤.
             // ì œê°€ 'ê°€ì¡± (ì—„ê²©)'ê³¼ 'íŒ¨ì…˜'ì„ ìƒì„±í•˜ê¸° ì „ì— 'ê°€êµ¬(quiz.html)'ë¥¼ ìƒì„±í–ˆì—ˆìŠµë‹ˆë‹¤.
             // 1. ê°€êµ¬ (quiz.html) - 10ê°œ
             // 2. ë™ë¬¼ (quiz_level_2.html) - 10ê°œ
             // 3. êµ­ê°€ (quiz_level_3.html) - 10ê°œ
             // 4. ê°€ì¡± (quiz_family.html) - 10ê°œ
             // 5. ê°€ì¡± (quiz_family_strict.html) - 10ê°œ (4ë²ˆê³¼ ë‹¨ì–´ ë™ì¼)
             // 6. íŒ¨ì…˜ (quiz_fashion.html) - 10ê°œ
             // 7. ê³¼ì¼ (quiz_fruits.html) - 10ê°œ
             // 8. í•™êµ (quiz_school.html) - 10ê°œ
             // 9. ìƒ‰ê¹” (quiz_colors.html) - 10ê°œ
             // 10. ì£¼ë°© (quiz_kitchen.html) - 10ê°œ
             // 11. ì‹ ì²´ (quiz_body.html) - 10ê°œ
             // 12. ìŠ¤í¬ì¸  (quiz_sports.html) - 10ê°œ
             // 13. ì•…ê¸° (quiz_instruments.html) - 10ê°œ
             // 14. ì§ì—… (quiz_jobs.html) - 10ê°œ
             // ì´ 14ê°œ ì„¸íŠ¸ * 10 = 140ê°œ ë§ìŠµë‹ˆë‹¤. 5ë²ˆ(ê°€ì¡± strict)ë„ ë³„ê°œ ì„¸íŠ¸ë¡œ ì³¤ìŠµë‹ˆë‹¤.
             // ìœ„ ëª©ë¡ì—ì„œ 14ë²ˆì§¸ ì„¸íŠ¸ (ì§ì—…)ê°€ 13ë²ˆìœ¼ë¡œ ì˜ëª» ê³„ì‚°ë˜ì—ˆìŠµë‹ˆë‹¤. 
             // 14. ì§ì—… (10ê°œ) -> ëª©ë¡ì— ìˆìŠµë‹ˆë‹¤.
             // ì´ 140ê°œ ë‹¨ì–´ì…ë‹ˆë‹¤. 
        ];


        let shuffledQuestions = [];
        let currentQuestionIndex = 0;
        let totalScore = 0;
        let currentPoints = 30; // [!!!] ìˆ˜ì •: 30ì  ì‹œì‘
        let questionTimer;
        let secondsElapsed;
        const TOTAL_QUESTIONS = 30; // [!!!] ìˆ˜ì •: 30ë¬¸ì œ

        // --- 2. HTML ìš”ì†Œ ê°€ì ¸ì˜¤ê¸° ---
        const questionCounterEl = document.getElementById('question-counter');
        const totalScoreEl = document.getElementById('total-score');
        const choseongDisplayEl = document.getElementById('choseong-display');
        const timerBarEl = document.getElementById('timer-bar');
        const initialHintTextEl = document.getElementById('initial-hint-text');
        
        // [!!!] ìˆ˜ì •: íŒíŠ¸ ìš”ì†Œ ì¶”ê°€
        const topicHintEl = document.getElementById('topic-hint');
        const imageHintEl = document.getElementById('image-hint');
        
        const answerInputEl = document.getElementById('answer-input');
        const submitBtnEl = document.getElementById('submit-btn');
        
        const feedbackCorrectEl = document.getElementById('feedback-correct');
        const feedbackWrongEl = document.getElementById('feedback-wrong');
        const feedbackTimeoutEl = document.getElementById('feedback-timeout');
        
        const gameOverOverlayEl = document.getElementById('game-over-overlay');
        const finalScoreEl = document.getElementById('final-score');
        const restartBtnEl = document.getElementById('restart-btn');
        
        const virtualKeyboardEl = document.getElementById('virtual-keyboard');

        // --- 3. í•µì‹¬ ê¸°ëŠ¥ í•¨ìˆ˜ ---

        const isTouchDevice = ('ontouchstart' in window) || (navigator.maxTouchPoints > 0);

        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        function startGame() {
            totalScore = 0;
            currentQuestionIndex = 0;
            // [!!!] ìˆ˜ì •: ë§ˆìŠ¤í„° ë±…í¬ì—ì„œ 30ê°œ ë¬´ì‘ìœ„ ì¶”ì¶œ
            shuffledQuestions = shuffleArray([...masterQuestionBank]).slice(0, TOTAL_QUESTIONS); 
            totalScoreEl.textContent = `ì´ ì ìˆ˜: 0 ì `;
            gameOverOverlayEl.style.display = 'none';
            displayQuestion();
        }

        // [!!!] ìˆ˜ì •: íŒíŠ¸ í‘œì‹œ ë¡œì§
        function showInHintArea(elementToShow) {
            // 1. í”¼ë“œë°± ìˆ¨ê¸°ê¸°
            feedbackCorrectEl.style.display = 'none';
            feedbackWrongEl.style.display = 'none';
            feedbackTimeoutEl.style.display = 'none';

            // 2. íŒíŠ¸ ìƒíƒœì— ë”°ë¼ í‘œì‹œ
            if (elementToShow === 'initial') {
                initialHintTextEl.style.display = 'block';
                topicHintEl.classList.add('hidden');
                imageHintEl.classList.add('hidden');
            } else if (elementToShow === 'topic') {
                initialHintTextEl.style.display = 'none';
                topicHintEl.classList.remove('hidden');
                imageHintEl.classList.add('hidden');
            } else if (elementToShow === 'image') {
                initialHintTextEl.style.display = 'none';
                topicHintEl.classList.remove('hidden'); // ì£¼ì œ íŒíŠ¸ ìœ ì§€
                imageHintEl.classList.remove('hidden'); // ì´ëª¨ì§€ íŒíŠ¸ ì¶”ê°€
            } else if (elementToShow === 'correct' || elementToShow === 'wrong' || elementToShow === 'timeout') {
                // ëª¨ë“  íŒíŠ¸ ìˆ¨ê¸°ê¸°
                initialHintTextEl.style.display = 'none';
                topicHintEl.classList.add('hidden');
                imageHintEl.classList.add('hidden');
                
                // í•´ë‹¹ í”¼ë“œë°± í‘œì‹œ
                if (elementToShow === 'correct') feedbackCorrectEl.style.display = 'block';
                if (elementToShow === 'wrong') feedbackWrongEl.style.display = 'block';
                if (elementToShow === 'timeout') feedbackTimeoutEl.style.display = 'block';
            }
        }
        
        function resetHints() {
            showInHintArea('initial');
        }

        function displayQuestion() {
            resetHints(); 

            answerInputEl.value = '';
            answerInputEl.disabled = false;
            submitBtnEl.disabled = false;
            
            if (isTouchDevice) {
                answerInputEl.readOnly = true;
                answerInputEl.style.caretColor = 'transparent';
            } else {
                answerInputEl.readOnly = false;
                answerInputEl.style.caretColor = 'auto';
                answerInputEl.focus();
            }

            // [!!!] ìˆ˜ì •: 30ë¬¸ì œ
            if (currentQuestionIndex >= TOTAL_QUESTIONS) {
                showGameResult();
                return;
            }

            // [!!!] ìˆ˜ì •: 30ì  ì‹œì‘
            currentPoints = 30;
            secondsElapsed = 0;
            timerBarEl.style.transition = 'none'; 
            timerBarEl.style.width = '100%';
            timerBarEl.style.backgroundColor = '#4caf50'; // ì´ˆë¡ìƒ‰
            
            const question = shuffledQuestions[currentQuestionIndex];
            choseongDisplayEl.textContent = question.choseong;
            // [!!!] ìˆ˜ì •: 30ë¬¸ì œ
            questionCounterEl.textContent = `ë¬¸ì œ ${currentQuestionIndex + 1} / ${TOTAL_QUESTIONS}`;

            clearInterval(questionTimer); 
            questionTimer = setInterval(updateTimer, 1000);
            
            setTimeout(() => {
                timerBarEl.style.transition = 'width 1s linear';
            }, 100);
        }

        // [!!!] ìˆ˜ì •: íƒ€ì´ë¨¸ ë¡œì§ (21ì´ˆ, 3ë‹¨ê³„)
        function updateTimer() {
            secondsElapsed++;
            const totalTime = 21; // ì´ 21ì´ˆ
            let timeRemainingPercent = 100 - (secondsElapsed / totalTime) * 100;
            timerBarEl.style.width = `${timeRemainingPercent}%`;

            if (secondsElapsed === 7) { // 7ì´ˆ ê²½ê³¼
                currentPoints = 20;
                showTopicHint();
                timerBarEl.style.backgroundColor = '#ffc107'; // ë…¸ë€ìƒ‰
            }
            else if (secondsElapsed === 14) { // 14ì´ˆ ê²½ê³¼
                currentPoints = 10;
                showImageHint();
                timerBarEl.style.backgroundColor = '#dc3545'; // ë¹¨ê°„ìƒ‰
            }
            else if (secondsElapsed === 21) { // 21ì´ˆ ê²½ê³¼ (íƒ€ì„ì•„ì›ƒ)
                currentPoints = 0;
                clearInterval(questionTimer);
                handleTimeout();
            }
        }

        // [!!!] ìˆ˜ì •: íŒíŠ¸ í‘œì‹œ í•¨ìˆ˜
        function showTopicHint() {
            const question = shuffledQuestions[currentQuestionIndex];
            topicHintEl.textContent = `ì£¼ì œ: ${question.topic}`;
            showInHintArea('topic'); 
        }

        function showImageHint() {
            const question = shuffledQuestions[currentQuestionIndex];
            imageHintEl.textContent = question.imageHint;
            showInHintArea('image'); 
        }

        function handleTimeout() {
            answerInputEl.disabled = true;
            submitBtnEl.disabled = true;
            
            const correctAnswerWord = shuffledQuestions[currentQuestionIndex].answer;
            feedbackTimeoutEl.textContent = `ì‹œê°„ ì´ˆê³¼! ì •ë‹µ: ${correctAnswerWord}`;
            showInHintArea('timeout'); 

            // ì‹œê°„ ì´ˆê³¼ ì‹œ ì²˜ìŒë¶€í„° ë‹¤ì‹œ ì‹œì‘
            setTimeout(startGame, 2000); 
        }

        function checkAnswer() {
            const userInput = answerInputEl.value.trim();
            const currentQuestion = shuffledQuestions[currentQuestionIndex];
            const correctAnswer = currentQuestion.answer;
            
            let isAnswerCorrect = false;

            if (!userInput) return; 
            
            // ì •í™•í•œ 1:1 ë§¤ì¹­
            if (userInput === correctAnswer) {
                isAnswerCorrect = true;
            }


            if (isAnswerCorrect) {
                clearInterval(questionTimer);
                answerInputEl.disabled = true;
                submitBtnEl.disabled = true;

                totalScore += currentPoints;
                totalScoreEl.textContent = `ì´ ì ìˆ˜: ${totalScore} ì `;
                
                // [!!!] ìˆ˜ì •: ì ìˆ˜ í‘œì‹œ
                feedbackCorrectEl.textContent = `ì •ë‹µ! +${currentPoints}ì `;
                showInHintArea('correct'); 

                currentQuestionIndex++;
                
                setTimeout(displayQuestion, 1500); 
            }
            else {
                feedbackWrongEl.textContent = 'í‹€ë ¸ìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•˜ì„¸ìš”.';
                showInHintArea('wrong'); 
                
                answerInputEl.value = ''; 
                
                if (!isTouchDevice) {
                    answerInputEl.focus();
                }

                // [!!!] ìˆ˜ì •: íŒíŠ¸ ìƒíƒœ ë³µì› ë¡œì§
                setTimeout(() => {
                    if (secondsElapsed >= 14) {
                        showInHintArea('image');
                    } else if (secondsElapsed >= 7) {
                        showInHintArea('topic');
                    } else {
                        showInHintArea('initial');
                    }
                }, 1000);
            }
        }

        function showGameResult() {
            finalScoreEl.textContent = `ìµœì¢… ì ìˆ˜: ${totalScore} ì `;
            gameOverOverlayEl.style.display = 'flex';

            const scoreMessage = {
                type: 'game_score',
                score: totalScore 
            };
            if (window.parent) {
                window.parent.postMessage(scoreMessage, '*');
            }
        }

        // --- 4. ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ---
        
        submitBtnEl.addEventListener('click', checkAnswer);
        answerInputEl.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                checkAnswer();
            }
        });
        restartBtnEl.addEventListener('click', startGame);
        
        virtualKeyboardEl.addEventListener('click', function(e) {
            const key = e.target.closest('.kbd-key');
            if (!key) return; 
            if (answerInputEl.disabled) return;

            let keyVal;
            const keyData = key.dataset.key; 
            
            if (keyData === 'shift') {
                toggleShift(); 
                return; 
            } 
            if (keyData === 'del') {
                handleBackspace();
            } else if (keyData === 'enter') {
                checkAnswer();
            } else {
                if (isShifted) {
                    keyVal = key.dataset.shift || key.dataset.key; 
                } else {
                    keyVal = key.dataset.key; 
                }
                typeHangul(keyVal); 
            }
            
            if (!isTouchDevice) {
                answerInputEl.focus();
            }
        });
        
        // --- 5. í•œê¸€ IME (ì¡°í•©/ë¶„í•´) ë¡œì§ ---

        const CHOSEONG = ['ã„±', 'ã„²', 'ã„´', 'ã„·', 'ã„¸', 'ã„¹', 'ã…', 'ã…‚', 'ã…ƒ', 'ã……', 'ã…†', 'ã…‡', 'ã…ˆ', 'ã…‰', 'ã…Š', 'ã…‹', 'ã…Œ', 'ã…', 'ã…'];
        const JUNGSEONG = ['ã…', 'ã…', 'ã…‘', 'ã…’', 'ã…“', 'ã…”', 'ã…•', 'ã…–', 'ã…—', 'ã…˜', 'ã…™', 'ã…š', 'ã…›', 'ã…œ', 'ã…', 'ã…', 'ã…Ÿ', 'ã… ', 'ã…¡', 'ã…¢', 'ã…£'];
        const JONGSEONG = ['', 'ã„±', 'ã„²', 'ã„³', 'ã„´', 'ã„µ', 'ã„¶', 'ã„·', 'ã„¹', 'ã„º', 'ã„»', 'ã„¼', 'ã„½', 'ã„¾', 'ã„¿', 'ã…€', 'ã…', 'ã…‚', 'ã…„', 'ã……', 'ã…†', 'ã…‡', 'ã…ˆ', 'ã…Š', 'ã…‹', 'ã…Œ', 'ã…', 'ã…'];
        
        const COMPLEX_JAMO_KEY = {
            'ã„±ã……': 'ã„³', 'ã„´ã…ˆ': 'ã„µ', 'ã„´ã…': 'ã„¶', 'ã„¹ã„±': 'ã„º', 'ã„¹ã…': 'ã„»', 'ã„¹ã…‚': 'ã„¼', 'ã„¹ã……': 'ã„½', 'ã„¹ã…Œ': 'ã„¾', 'ã„¹ã…': 'ã„¿', 'ã„¹ã…': 'ã…€', 'ã…‚ã……': 'ã…„',
            'ã…—ã…': 'ã…˜', 'ã…—ã…': 'ã…™', 'ã…—ã…£': 'ã…š', 'ã…œã…“': 'ã…', 'ã…œã…”': 'ã…', 'ã…œã…£': 'ã…Ÿ', 'ã…¡ã…£': 'ã…¢'
        };
        
        const DECOMPOSE_COMPLEX_JAMO = {
            'ã„³': ['ã„±', 'ã……'], 'ã„µ': ['ã„´', 'ã…ˆ'], 'ã„¶': ['ã„´', 'ã…'], 'ã„º': ['ã„¹', 'ã„±'], 'ã„»': ['ã„¹', 'ã…'], 'ã„¼': ['ã„¹', 'ã…‚'], 'ã„½': ['ã„¹', 'ã……'], 'ã„¾': ['ã„¹', 'ã…Œ'], 'ã„¿': ['ã„¹', 'ã…'], 'ã…€': ['ã„¹', 'ã…'], 'ã…„': ['ã…‚', 'ã……'],
            'ã…˜': ['ã…—', 'ã…'], 'ã…™': ['ã…—', 'ã…'], 'ã…š': ['ã…—', 'ã…£'], 'ã…': ['ã…œ', 'ã…“'], 'ã…': ['ã…œ', 'ã…”'], 'ã…Ÿ': ['ã…œ', 'ã…£'], 'ã…¢': ['ã…¡', 'ã…£']
        };

        const HANGUL_START = 0xAC00;
        const HANGUL_END = 0xD7A3;
        
        function compose(choIdx, jungIdx, jongIdx) {
            return String.fromCharCode(HANGUL_START + (choIdx * 21 * 28) + (jungIdx * 28) + jongIdx);
        }

        function decompose(char) {
            const code = char.charCodeAt(0);
            if (code < HANGUL_START || code > HANGUL_END) {
                return null;
            }
            const unicode = code - HANGUL_START;
            const jongIdx = unicode % 28;
            const jungIdx = ((unicode - jongIdx) / 28) % 21;
            const choIdx = Math.floor(((unicode - jongIdx) / 28) / 21);
            return [choIdx, jungIdx, jongIdx];
        }
        
        function typeHangul(key) {
            const val = answerInputEl.value;
            const lastChar = val.slice(-1);
            
            const isJung = JUNGSEONG.includes(key); 
            const isJong = JONGSEONG.includes(key); 

            if (isShifted) {
                toggleShift();
            }

            if (!lastChar || !decompose(lastChar)) {
                if (CHOSEONG.includes(lastChar) && isJung) {
                    const choIdx = CHOSEONG.indexOf(lastChar);
                    const jungIdx = JUNGSEONG.indexOf(key);
                    answerInputEl.value = val.slice(0, -1) + compose(choIdx, jungIdx, 0); 
                }
                else {
                    answerInputEl.value += key;
                }
                return;
            }

            const [choIdx, jungIdx, jongIdx] = decompose(lastChar);

            if (jongIdx === 0) {
                const jung = JUNGSEONG[jungIdx];
                const combinedJung = COMPLEX_JAMO_KEY[jung + key]; 
                
                if (isJung && combinedJung) {
                    const newJungIdx = JUNGSEONG.indexOf(combinedJung);
                    answerInputEl.value = val.slice(0, -1) + compose(choIdx, newJungIdx, 0);
                }
                else if (isJong) {
                    const newJongIdx = JONGSEONG.indexOf(key);
                    if (newJongIdx > 0) { 
                         answerInputEl.value = val.slice(0, -1) + compose(choIdx, jungIdx, newJongIdx);
                    } else {
                         answerInputEl.value += key;
                    }
                }
                else {
                    answerInputEl.value += key;
                }
            }
            else {
                const jong = JONGSEONG[jongIdx];
                const combinedJong = COMPLEX_JAMO_KEY[jong + key]; 

                if (isJung) {
                    let lastCharJong, newCharCho; 
                    const decomposedJong = DECOMPOSE_COMPLEX_JAMO[jong];
                    
                    if (decomposedJong) { 
                        lastCharJong = decomposedJong[0];
                        newCharCho = decomposedJong[1];
                    } else { 
                        lastCharJong = '';
                        newCharCho = jong;
                    }

                    const newLastJongIdx = JONGSEONG.indexOf(lastCharJong);
                    const newCharChoIdx = CHOSEONG.indexOf(newCharCho);
                    const newCharJungIdx = JUNGSEONG.indexOf(key);

                    answerInputEl.value = val.slice(0, -1) + 
                                          compose(choIdx, jungIdx, newLastJongIdx) + 
                                          compose(newCharChoIdx, newCharJungIdx, 0);
                }
                else if (isJong && combinedJong && JONGSEONG.includes(combinedJong)) {
                    const newJongIdx = JONGSEONG.indexOf(combinedJong);
                    answerInputEl.value = val.slice(0, -1) + compose(choIdx, jungIdx, newJongIdx);
                }
                else {
                    answerInputEl.value += key;
                }
            }
        }
        
        function handleBackspace() {
            const val = answerInputEl.value;
            if (val.length === 0) return;

            const lastChar = val.slice(-1);
            const decomposed = decompose(lastChar);
            
            if (!decomposed) {
                answerInputEl.value = val.slice(0, -1);
                return;
            }

            const [choIdx, jungIdx, jongIdx] = decomposed;
            
            if (jongIdx > 0) {
                const jong = JONGSEONG[jongIdx];
                const decomposedJong = DECOMPOSE_COMPLEX_JAMO[jong]; 

                if (decomposedJong) {
                    const newJongIdx = JONGSEONG.indexOf(decomposedJong[0]);
                    answerInputEl.value = val.slice(0, -1) + compose(choIdx, jungIdx, newJongIdx);
                } 
                else {
                    answerInputEl.value = val.slice(0, -1) + compose(choIdx, jungIdx, 0);
                }
            }
            else {
                const jung = JUNGSEONG[jungIdx];
                const decomposedJung = DECOMPOSE_COMPLEX_JAMO[jung]; 

                if (decomposedJung) {
                    const newJungIdx = JUNGSEONG.indexOf(decomposedJung[0]);
                    answerInputEl.value = val.slice(0, -1) + compose(choIdx, newJungIdx, 0);
                }
                else {
                    answerInputEl.value = val.slice(0, -1) + CHOSEONG[choIdx];
                }
            }
        }
        
        let isShifted = false;
        const shiftKeyEl = document.querySelector('.kbd-key[data-key="shift"]');
        const shiftableKeyEls = document.querySelectorAll('.kbd-key[data-shift]');
        
        function toggleShift() {
            isShifted = !isShifted;
            shiftKeyEl.classList.toggle('shift-active', isShifted);
            
            shiftableKeyEls.forEach(keyEl => {
                 const originalKey = keyEl.dataset.key; 
                 const shiftKey = keyEl.dataset.shift; 
                 
                 if (isShifted) {
                      keyEl.textContent = shiftKey; 
                 } else {
                      keyEl.textContent = originalKey; 
                 }
            });
        }

        // --- 6. ê²Œì„ ì‹œì‘ ---
        startGame();

    </script>
</body>
</html>
